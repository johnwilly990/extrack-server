# ![budgeter-logo](https://user-images.githubusercontent.com/88567467/207757998-483a12d5-8cf4-45a4-b14d-cb9d0350b403.svg) Budgeter API

API created to serve financial data to Budgeter from a database

## Run Locally / Usage

Clone the project

```bash
git clone https://github.com/johnwilly990/budgeter-server.git
```

Go to the project directory

```bash
cd budgeter-server
```

Install dependencies

```bash
npm install
```

Run table migration

```bash
npm run migrate
```

Start the server

```bash
npm run dev
```

## Environment Variables

To run this project, you will need to add the following environment variables to your .env file

`DB_LOCAL_HOST`

`DB_LOCAL_USER`

`DB_LOCAL_PASS`

`DB_LOCAL_NAME`

`PORT`

`SECRET_KEY`

`SECRET_KEY` can be generated by running this command in your terminal

```bash
openssl rand -base64 12
```

## Tech Stack

- node.js, express.js, jwt, knex.js, MySQL

## DB Schemas

### `users`

| name                      | type               |
| ------------------------- | ------------------ |
| `id`                      | PK (uuid)          |
| `username`                | string, NOT NULL   |
| `password`                | string, NOT NULL   |
| `first_name`              | string, NOT NULL   |
| `last_name`               | string, NOT NULL   |
| `income_amount`           | int, NOT NULL      |
| `budget_amount`           | int, NOT NULL      |
| `recurring_amount`        | int, NOT NULL      |
| `saving_amount`           | int, NOT NULL      |
| `investment_amount`       | int, NOT NULL      |
| `flexible_expense_amount` | int, NOT NULL      |
| `created_at`              | datetime, NOT NULL |
| `updated_at`              | datetime, NOT NULL |

### `recurring_expenses_entries`

| name         | type               |
| ------------ | ------------------ |
| `id`         | PK (uuid)          |
| `user_id`    | FK (`users`)       |
| `item_name`  | string, NOT NULL   |
| `amount`     | int, NOT NULL      |
| `category`   | string, NOT NULL   |
| `created_at` | datetime, NOT NULL |
| `updated_at` | datetime, NOT NULL |

### `flexible_expenses_entries`

| name         | type               |
| ------------ | ------------------ |
| `id`         | PK (uuid)          |
| `user_id`    | FK (`users`)       |
| `item_name`  | string, NOT NULL   |
| `amount`     | int, NOT NULL      |
| `category`   | string, NOT NULL   |
| `created_at` | datetime, NOT NULL |
| `updated_at` | datetime, NOT NULL |

## API Endpoints

NOTE: All enpoints except `/api/signup` and `/api/login` require to be sent as `headers`

```json
{
  headers: {Authorization: `Bearer ${token}`}
}
```

### Error Messages

All errors -- user generated or otherwise -- should return an error response in the following format:

```json
{
  "status": 400,
  "message": "Your appropriate message goes here"
}
```

- `status`: returns the appropriate HTTP status starting with 4xx or 5xx
- `message`: an appropriate error message

### Response codes

- 200 - OK: Everything worked as expected.
- 201 - Created: A new resource was created.
- 400 - Bad Request: The request was unacceptable, often due to missing a required parameter.
- 500 - Server Error: Server encountered something it didn't expect; unable to complete the request.

### `POST /api/signup`

Signs up new user

- Request body should have the following properties as an example:

```json
 {
   "username": username,
   "password": password,
   "first_name": first_name,
   "last_name": last_name
 }
```

- Response returns 400 if unsuccessful because of missing properties in the request body
- Response returns 201 if successful:

```json
{
  "success": true,
  "message": "Sign up successful"
}
```

### `POST /api/login`

Logs in signed up user

- Request body should have the following properties as an example:

```json
 {
   "username": username,
   "password": password,
 }
```

- Response returns 400 if unsuccessful because of missing properties in the request body
- Response returns 201 if successful:

```json
 {
   "message": "User logged in successfully",
   "token": token,
 }
```

### `GET /api/profile`

Get user info based on JWT token

- Response returns 200 if successful:

```json
{
  "id": <id>,
  "username": <username>,
  "first_name": <first_name>,
  "last_name": <last_name>,
  "income_amount": <income_amount>,
  "budget_amount": <budget_amount>,
  "saving_amount": <saving_amount>,
  "investment_amount": <investment_amount>,
  "recurring_amount": <recurring_amount>,
  "flexible_expense_amount": <flexible_expense_amount>
}
```

### `PUT /api/profile`

Updates user funds (income, savings, investments)

- Request body should have the following properties as an example:

```json
{
   "income_amount": income_amount,
   "saving_amount": saving_amount,
   "investment_amount": investment_amount
}
```

- Response returns 200 if successful:

```json
{
   "message": "User funds successfully updated",
   "user": `Number of users updated, ${user}`,
}
```

### `POST /api/recurring`

Posts new recurring expense entry

- Request body should have the following properties as an example:

```json
{
   "item_name": item_name,
   "amount": amount,
   "category": category
}
```

- Response returns 200 if successful:

```json
{
  "message": "New entry successfully added"
}
```

### `GET /api/recurring`

Gets all recurring expenses of user

- Response returns 200 if successful:

```json
{
   "id": <id>,
   "item_name": <item_name>,
   "amount": <amount>,
   "category": <category>
}
```

- Response returns 400 if unsuccessful:

```json
{
  "message": "No recurring expenses found"
}
```

### `PUT /api/recurring/:id`

Updates recurring expense based on `id`

- Request body should have the following properties as an example:

```json
{
   "item_name": item_name,
   "amount": amount,
   "category": category
}
```

- Response returns 200 if successful:

```json
{
  "message": "Entry successfully updated"
}
```

### `DELETE /api/recurring/:id`

Deletes recurring expense based on `id`

- Response returns 200 if successful:

```json
{
  "message": "Entry successfully deleted"
}
```

### `POST /api/flexible`

Posts new flexible expense entry

- Request body should have the following properties as an example:

```json
{
   "item_name": item_name,
   "amount": amount,
   "category": category
}
```

- Response returns 200 if successful:

```json
{
  "message": "New entry successfully added"
}
```

### `GET /api/flexible`

Gets all fleixble expenses of user

- Response returns 200 if successful:

```json
{
   "id": <id>,
   "item_name": <item_name>,
   "amount": <amount>,
   "category": <category>
}
```

- Response returns 400 if unsuccessful:

```json
{
  "message": "No flexible expenses found"
}
```

### `PUT /api/flexible/:id`

Updates flexible expense based on `id`

- Request body should have the following properties as an example:

```json
{
   "item_name": item_name,
   "amount": amount,
   "category": category
}
```

- Response returns 200 if successful:

```json
{
  "message": "Entry successfully updated"
}
```

## Lessons learned

- Database management can get real tricky
- Usage of middlewares are critical for clean and readable code

## Next Steps

- Make schemas for invesments and savings
- Make schemas for each category of both recurring and flexible expenses so that users can get more data based on category
- Clean up code; make use of more middlewares
